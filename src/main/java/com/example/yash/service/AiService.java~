package com.example.yash.service;

import org.springframework.ai.chat.model.ChatModel;
import org.springframework.ai.reader.tika.TikaDocumentReader;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.io.InputStreamResource;
import org.springframework.core.io.Resource;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.ai.document.Document;


import java.io.IOException;
import java.util.List;
import java.util.Objects;
import java.util.stream.Collectors;

@Service
public class AiService {

    @Value("${GEMINI_API_KEY}")
    private String apiKey;

    @Autowired
    private ChatModel chatModel;


    public String getAtsScore(MultipartFile file) throws IOException {

        Resource resource = new InputStreamResource(file.getInputStream());

        TikaDocumentReader reader = new TikaDocumentReader(resource);
        List<Document> documents = reader.get();

        String content = documents.stream()
                .map(Document::getText)
                .collect(Collectors.joining("\n"));

        return chatModel.call("Analyze this resume and provide ATS insights:\n" + content);
    }
}
